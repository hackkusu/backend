# api microservice

<a href="https://heroku.com/deploy?template=https://github.com/hackkusu/backend.git">
  <img src="https://www.herokucdn.com/deploy/button.svg" alt="Deploy">
</a>

This repo contains Python backend code and configuration files for Heroku. 

https://devcenter.heroku.com/articles/heroku-button

https://github.com/app-json/app.json#validating-a-manifest

Sync videos repo

## Local setup

python==3.8.10

To develop locally create `.env` file within `./src` directory and add following code to it:  
```
DEBUG=True
SECRET_KEY=<insert_secret_key_here>
ALLOWED_HOSTS=*,
```

Once container is up and running apply migrations (a one-time operation) and create superuser by executing:  
`docker ps` -> to list all running containers and retrieve id or name of running backend container  
`docker exec -it <id_or_name_of_running_container> /bin/bash` -> to enter the container  
`python manage.py migrate` -> to execute migrations  
`python manage.py createsuperuser` -> to create superuser  
`exit` -> to exit the container  

Test review app

## create db
```shell
create user polls with password 'test1234' SUPERUSER;
```
```shell
create database polls with owner polls;
```


`. venv/bin/activate` (python 3.9)`

`pip install -r requirements/dev.txt`

`cd src && python manage.py makemigrations`


https://thinkster.io/tutorials/django-json-api/authentication

https://github.com/chase2981/conduit-django/blob/09-filtering/conduit/apps/articles/serializers.py

https://django-rest-framework-json-api.readthedocs.io/en/stable/usage.html#queryparametervalidationfilter

https://medium.com/@raaj.akshar/creating-reverse-related-objects-with-django-rest-framework-b1952ddff1c

https://stackoverflow.com/questions/41394761/the-create-method-does-not-support-writable-nested-fields-by-default

2023

```shell
python manage.py createsuperuser --username superuser --email superuser@gfic.io
python manage.py drf_create_token superuser
```

```
curl --location 'http://localhost:8000/api/auth/login/' \
--header 'Content-type: application/json' \
--data '{
      "username": "chase",
      "password": "test"
  }'
```

```shell
 python manage.py dumpdata auth authtoken account polls.user --indent 2 > superuser.json


```


https://testdriven.io/blog/django-rest-auth/
https://github.com/turbonemesis/django-rest-allauth
https://simpleisbetterthancomplex.com/tutorial/2018/11/22/how-to-implement-token-authentication-using-django-rest-framework.html

custom user model

https://testdriven.io/blog/django-custom-user-model/

https://www.digitalocean.com/community/tutorials/how-to-add-authentication-to-your-app-with-flask-login

angular

https://nx.dev/getting-started/tutorials/angular-standalone-tutorial

django rest

https://dynamic-rest.readthedocs.io/en/latest/tutorial.html

create custom migration

```shell
python manage.py makemigrations your_app_name --empty --name custom_migration_name

```

```shell
# Generated by Django 2.1.7 on 2024-03-13 21:56

from django.db import migrations
from django.core.exceptions import ObjectDoesNotExist


def add_user_groups_permissions(apps, schema_editor):
    User = apps.get_model('polls', 'User')
    AuthGroup = apps.get_model('polls', 'AuthGroup')
    AuthPermission = apps.get_model('polls', 'AuthPermission')

    auth_permissions = ['upload_video']
    for permission in auth_permissions:
        try:
            auth_permission = AuthPermission.objects.get(codename=permission)
        except ObjectDoesNotExist:
            auth_permission = AuthPermission(codename=permission, content_type_id=0, name=permission)
            auth_permission.save()

class Migration(migrations.Migration):

    dependencies = [
        ('polls', '0002_auto_20240313_1951'),
    ]

    operations = [
        migrations.RunPython(add_user_groups_permissions, reverse_code=migrations.RunPython.noop),
    ]

```
